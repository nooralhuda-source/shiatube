<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShiaTube • Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
</head>
<body>

  <!-- HEADER / NAV -->
  <header>
    <h1>ShiaTube</h1>
    <nav>
      <a class="nav-link" href="home.html">Home</a>
      <a class="nav-link" href="home.html?cat=Shorts">Shorts</a>
      <a class="nav-link" href="home.html?cat=Latmiyas">Latmiyas</a>
      <a class="nav-link" href="home.html?cat=Long-Form">Long-Form</a>
      <a class="nav-link" href="upload.html">Upload</a>
    </nav>
    <div id="user-nav">
      <button id="signin-btn" class="btn">Sign In</button>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <section id="home">
      <h2 id="home-title">All Videos</h2>
      <div id="videoGrid" class="video-grid"></div>
    </section>
  </main>

  <footer>
    &copy; 2025 Noor Al Huda — ShiaTube
  </footer>

  <script>
    // 1) Initialize Supabase
    const SUPABASE_URL = 'YOUR_SUPABASE_URL'
    const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY'
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

    // 2) Read category from URL (?cat=Shorts)
    const params = new URLSearchParams(location.search)
    const category = params.get('cat') || ''
    document.getElementById('home-title').textContent = category || 'All Videos'

    // 3) Load videos from Supabase
    async function loadVideos() {
      let query = supabase
        .from('videos')
        .select('*')
        .order('inserted_at', { ascending: false })
      if (category) query = query.eq('category', category)

      const { data: videos, error } = await query
      if (error) return console.error(error)
      const grid = document.getElementById('videoGrid')
      grid.innerHTML = ''

      videos.forEach(v => {
        const card = document.createElement('div')
        card.className = 'video-card'
        card.innerHTML = `
          <iframe
            src="https://www.youtube.com/embed/${v.youtube_id}"
            allowfullscreen>
          </iframe>
          <div class="info">${v.title}</div>
        `
        card.onclick = () => {
          // go to watch page, passing the ID
          location.href = `watch.html?id=${v.id}`
        }
        grid.appendChild(card)
      })
    }

    // 4) Update Sign-In / Sign-Out Nav
    async function updateNav() {
      const user = supabase.auth.user()
      const nav = document.getElementById('user-nav')
      if (user) {
        nav.innerHTML = `
          <span>${user.email}</span>
          <button class="btn" onclick="supabase.auth.signOut().then(updateNav)">
            Sign Out
          </button>
        `
      } else {
        nav.innerHTML = `
          <button class="btn" onclick="location.href='auth.html'">
            Sign In
          </button>
        `
      }
    }
    supabase.auth.onAuthStateChange(updateNav)
    updateNav()

    // 5) Kick it all off
    loadVideos()
  </script>
</body>
</html>
